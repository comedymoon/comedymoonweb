<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>comedymoon guard â€” admin</title>
<style>
  body{margin:0;font-family:Inter,system-ui,-apple-system,Arial;background:#0b0c15;color:#e8ecff}
  header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0f1022;border-bottom:1px solid #23264b}
  h1{font-size:18px;margin:0}
  main{max-width:920px;margin:20px auto;padding:0 16px}
  section{background:#111331;border:1px solid #23264b;border-radius:12px;padding:16px;margin-bottom:16px}
  label{display:block;margin:8px 0 4px;color:#b6c2ff}
  input,button{padding:10px 12px;border-radius:8px;border:1px solid #2b2f63;background:#0e1130;color:#e8ecff}
  button{cursor:pointer;font-weight:800}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #23264b;padding:8px;text-align:left}
  .muted{color:#9aa3c7}
</style>
</head>
<body>
<header><h1>ðŸ›¡ comedymoon guard</h1><button id="logout">Logout</button></header>
<main>
  <section>
    <h2>Block IP</h2>
    <label>IP</label><input id="ip" placeholder="1.2.3.4">
    <label>TTL (seconds)</label><input id="ttl" value="3600">
    <button id="block">Block</button>
  </section>
  <section>
    <h2>Active blocks</h2>
    <table>
      <thead><tr><th>IP</th><th>Until</th><th></th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
    <div class="muted" id="empty"></div>
  </section>
</main>
<script>
async function api(path, opts={}){
  const r = await fetch('/admin/api'+path, Object.assign({headers:{'Content-Type':'application/json'}}, opts));
  if(!r.ok) throw new Error('API '+r.status);
  return await r.json();
}
async function refresh(){
  const data = await api('/list');
  const tbody = document.getElementById('rows'); tbody.innerHTML='';
  const empty = document.getElementById('empty'); empty.textContent='';
  if(!data.length){ empty.textContent='No active blocks'; return; }
  for(const row of data){
    const tr = document.createElement('tr');
    const d = new Date(row.until).toLocaleString();
    tr.innerHTML = `<td>${row.ip}</td><td>${d}</td>
      <td><button data-ip="${row.ip}">Unblock</button></td>`;
    tbody.appendChild(tr);
  }
}
document.getElementById('block').onclick = async ()=>{
  const ip=document.getElementById('ip').value.trim(); const ttl=document.getElementById('ttl').value.trim();
  await api('/block',{method:'POST',body:JSON.stringify({ip,ttl})}); refresh();
}
document.getElementById('rows').addEventListener('click', async (e)=>{
  if(e.target.tagName==='BUTTON'){ await api('/unblock',{method:'POST',body:JSON.stringify({ip:e.target.dataset.ip})}); refresh(); }
});
document.getElementById('logout').onclick = ()=>{ document.cookie='adm=; Max-Age=0; path=/'; location='/admin/login'; }
refresh();
</script>
</body></html>